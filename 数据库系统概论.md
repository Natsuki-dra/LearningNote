# 数据库系统概论

## 1.概述

### 数据库的概念

​		数据库是长期存储在计算机内、有组织的、可大量共享的大量数据的集合。数据库中的数据按一定的数据模型组织、描述和存储，具有**较小的冗余度**、**较高的数据独立性**和**易扩展性**。

​		概括的讲，数据库数据具有**永久存储、有组织和可共享**三个基本特征

### 数据库管理系统DBMS(Database Management System)

主要功能包括：

​		1.数据定义功能：

​					系统提供数据定义语言（Data Defination Language,DDL)

​		2.数据组织、存储和管理

​		3.数据操纵功能

​					系统提供数据操纵语言（Data Manipulation Language,DML)

​		4.数据库的事务管理和维护功能

​		5.数据库的建立和维护功能

​		6.其他功能

### 数据库系统（DataBase System, DBS)

​		数据库系统由数据库、数据库管理系统、应用程序、数据库管理员（DBA）组成的存储、管理和维护数据的系统

### 数据管理技术的产生和发展

​		数据库管理技术经历了人工管理、文件系统、数据库系统三个阶段

#### 人工管理时代

​		数据存储靠纸带、卡片、磁带等

特点:

​		1.数据不需要长期保存，用完就走

​		2.应用程序管理数据。哪个程序调用数据，就哪个程序来设计数据的结构。

​		3.数据不共享

​		4.数据不具有独立性

#### 文件系统阶段

​		操作系统中有专门的数据管理软件，一般称为文件系统，**处理方式不仅有了批处理，还能够联机实时处理**

特点：

​		1.数据可以长期保存

​		2.由文件系统管理数据（利用文件名访问）

​		缺点：

​				数据共享性差，冗余度大

​				数据独立性差（依赖于应用程序的设计）

#### 数据库系统阶段

特点：

​		1.数据结构化

​		2.数据共享性高、冗余度低且易扩充

​		3.数据独立性高

​		4.数据由数据库管理系统统一管理和控制

​				数据库管理系统需要提供以下几方面的数据控制功能

​				**1.数据的安全性保护**

​				**2.数据的完整性检查**

​				**3.并发控制**

​				**4.数据库恢复**



## 2.数据模型

​	数据模型主要分为两大类：概念模型，逻辑模型和物理模型

### 1.概念模型

​		按用户观点来对数据进行建模

​		基本概念:

​				实体（一个对象）、属性（一个对象具有的内在属性）、码（唯一标识对象的属性集）、实体型（描述一类实体的描述）、实体集（实体的集合）、联系（实体内部之间的联系、实体间的联系）

​				实体与实体之间的联系由**一对一，一对多，多对多**等多种类型

​		表示方法：

​				实体-联系方法**（E-R方法，也称E-R模型）**

​		

### 2.逻辑模型和物理模型

​		以计算机的观点来对数据进行建模

​		逻辑模型主要包括：

​						层次模型

​								结构像一棵树

​						网状模型

​								结构像一张图

​						关系模型

​						面向对象数据模型

​						对象关系数据模型

​						半结构化数据模型

### 数据模型组成要素

​		通常由三部分组成：

​				数据结构

​				数据操作

​				数据的完整性约束条件



## 3.数据库系统的结构

​		从数据库应用开发人员角度看，数据库系统通常采用三级模式结构

​		从数据库最终用户角度看，数据库系统的结构分为单用户结构、主从式结构、分布式结构、客户-服务器、浏览器-应用服务器/数据库服务器多层结构



### 数据库系统模式

​		模式是数据库中全体数据的逻辑结构和特征的描述（仅仅涉及型的描述）

​		模式的一个具体的值称为模式的一个实例

​		**模式是相对稳定的，而实例是相对变动的**

### 三级模式架构



#### 1.模式（schema)

​		模式也称逻辑模式，是数据库中全体数据的逻辑结构和特征的描述，是所有用户的公共数据视图

​		数据库管理系统提供模式数据定义语言（模式DDL）来严格定义模式

#### 2.外模式（external schema）

​		也称子模式或用户模式，是数据库用户能够看见和使用的局部数据的逻辑结构和特征的描述，是数据库用户的数据视图，是与某一应用有关的数据的逻辑表示

​		通常是模式的子集

#### 3.内模式（internal schema)

​		也称存储模式，一个数据库只有一个内模式。它是数据物理结构和存储方式的描述，是数据在数据库内部的组织方式。



### 二级映像功能以及数据独立性

为了实现三个抽象层次的联系和转换，数据库在这三级模式之间提供了两层映像：

#### 1.外模式/模式映像

​		对于每一个外模式，都有一个外模式/模式映像。

​		当模式改变时，只要由管理员对外模式/模式映像作相应改变，既可以保证外模式不变（逻辑性）。应用程序是根据外模式写的，因此应用程序也不需要改变

#### 2.模式/内模式映像

​		模式/内模式映像是唯一的，它定义了数据全局逻辑结构与存储结构之间的对应关系。

​		内模式改变时，只要由管理员对模式/内模式映像做出相应改变，可以保证模式不变（物理性）



​		

# 关系数据库

## 一、关系数据结构及形式化定义

### 1.什么是关系？

| 学生 | 专业   | 导师    |
| ---- | ------ | ------- |
| 张三 | 计算机 | Natsuki |
| 李四 | 计算机 | Natsuki |
| 王五 | 机械   | dragon  |
| 赵六 | 机械   | dragon  |

​		观看上面这张表。可以得知很多信息：

​				1.张三的导师是Natsuki，张三的专业是计算机	

​				2.李四的导师也是Natsuki，他的专业也是计算机

​				3.王五的导师是dragon，而他的专业是机械

​				。。。

​				4.Natsuki的学生有张三和李四

​				5.dragon的学生有王五和赵六

​				。。。

#### 		何为关系？

​				从上面的几点描述中可以知道，张三和计算机和Natsuki有关系。而在计算机中如何表达关系？通过一个一个元组（学生，专业，导师）可以得知表中表达的关系。如：（张三，计算机，Natsuki）、（王五，机械，dragon）等等。现在我们可以通过这一个元组得知一个一个关系了。

#### 		何为域？

​				域即为这个属性可以取值的集合。

​				还是从上面的表中看，很容易得知有三个域：

​						D1(学生域) = {张三，李四，王五，赵六}

​						D2（专业域）= {计算机，机械}

​						D3（老师域）= {Natsuki，dragon}

​				一个域即为一个集合。再者，甚至可以说这张表只有两个域：

​						D1（人类域）= {张三，李四，王五，赵六，Natsuki，dragon}

​						D2（专业域）= {计算机，机械}

​				**域是一组具有相同数据类型的值的集合**

​				学生，专业，老师则为域名

#### 		笛卡尔积是什么？

​				笛卡尔积用来描述关系的复杂程度。-------没有任何限制的情况下，多个域可以存在多少种不同的关系。

​				**笛卡尔积为所有可能组成的关系的集合。**

​				如上一问中提到的三个域：D1,D2,D3，总共可以配出4×2×2=16种搭配。当然，显示情况中不可能有这么多种关系。因此关系必须是笛卡尔积的子集。



​				如何表示笛卡尔积？

​				有给定的一组域：D1,D2,D3,...,Dn，笛卡尔积的表达即为：

​						D1×D2×D3×。。。×Dn={（d1,d2,d3,...,dn）|di∈Di，i=1，2，3，。。。，n}

​				“（）”小括号括起来的称为一个元组，其中有n个分量，一个di称为一个分量。一个元组有n个分量称为n元组。

​				di可取值的个数则称为Di的基数，用大写字母M表示。

​				笛卡尔积也有基数，其基数即为所有域的基数之积

#### 如何表达关系？

​		用R（D1,D2,D3,D4,...,Dn）来表示<u>关系</u>，n称为关系的度或目

​		n=1称为一（单）元关系，n=2称为双元关系

​		一个元组的不同分量表示不同的属性，不同分量可以来自同一个域。



#### 候选码？

​		可以用一”组“属性来唯一标识一个元组。

​		如果某一个属性组的值能唯一标识一个元组，那么该属性组称为候选码。

​		譬如，什么时候需要一组属性组来标识一个元组呢？

​				最典型的莫过于身份证号码，身份证号码由地区，出生日期，序号来唯一确定一个人，当他能唯一标识一个人以后，自然可以知道他的各种属性。身份证号码可以由三个属性组成，也可以由一个属性组成。而在学校中，学号自然就是我们的候选码。

​				有一个存储着全校学生信息的数据库，记录了学生的很多信息，包括身份证号码和学号。这两个属性组都可以唯一标识一名学生。为了方便管理数据库，一般都会将学号作为该关系的**主码**。

​				候选码的各个属性称为主属性，不属于候选码的属性称为非主属性或非码属性

​				若关系中所有属性是关系模式的候选码，则称之为全码。

#### 三种类型

​		关系可以分为三种类型：基本关系（基本表/基表），查询表，视图表

​		基本表是实际存在的表，所有属性均列在其中。一般调用select * from tablename就是调出基本表。

​		关系作为数据库结构时有如下规定：

​				无限关系在数据库中是无意义的。关系必须是有限的集合

​				通过为关系的每一个列附加一个属性名的方法取消了关系属性的有序性

​		**分量必须取原子值（不可再被拆分）**

### 2.什么是关系模型？

​		在关系数据库中，包含了关系模型和关系。数据库中有了关系以后，就需要关系模型来对关系进行描述。

​		关系模式需要描述哪几方面的信息？

​		关系名、关系的各属性、分量（属性）的来源（域属）、属性与域的映像关系以及属性间数据的依赖关系

​		关系模式用符号来描述为：

​				R（U,D,DOM,F）

​		R 为关系名

​		U 为该关系的属性名的集合

​		D 为U中属性所来自的域

​		DOM 为属性向域的映像集合

​		F 为属性见数据的依赖关系集合

关系是关系模式在某一时刻的状态或内容。而关系模式是静态的、稳定的。

### 3.关系操作

​		关系模型中常用的关系操作包括**查询query**，**修改update**，**插入insert**，**删除delete**

​		其中，查询操作又可以分为**选择select**，**投影project**，**连接join**，**除divide**，**并union**，**差except**，**交intersection**，**笛卡尔积**等等

​		关系操作的特点是集合操作方式，即操作的对象和结果都是集合。

### 4.关系的完整性

​		关系的完整性规则是对关系的某种约束的条件。

​		关系模型中包括三类完整性约束：**实体完整性**，**参照完整性**，**用户定义的完整性**

​		其中，前两个并称关系的两个不变性，由关系系统自动支持。

#### 实体完整性

​		若属性A是基本关系R的主属性，则A不能够取空值。

#### 参照完整性

​		现有两个关系：

​				学生（<u>学号</u>，姓名，性别，专业号，年龄）

​				专业（<u>专业号</u>，专业名）

​		两个关系之间存在着属性的引用，学生中的专业号必须是确实存在的专业的专业号

​		假设F是基本关系R的一个或一组属性，但不是关系R的码，Ks是S的**主码**。如果F与Ks相对应，则称F是R的**外码**，并称基本关系R为参照关系，基本关系S是被**参照关系**或目标关系。

​		**参照完整性规则：若属性F是基本关系R的外码，他与基本关系S的主码Ks相对应，则对于R中每个元组在F上的值必须：**

​			**或取控制；**

​			**或等于S中的某个元组的主码的值**

### 5.关系代数

​		关系代数是一种抽象的查询语言，它用对关系的运算来表达查询

| 运算符 | 含义     |
| ------ | -------- |
| ∪      | 并       |
| -      | 差       |
| ∩      | 交       |
| ×      | 笛卡尔积 |
| σ      | 选择     |
|        | 投影     |
|        | 连接     |
| ÷      | 除       |



连接：

​		从**两个关系的笛卡尔积**中选取**属性间满足一定条件**的元组

​		最常见有两种连接：**等值连接**，**自然连接**

​		**等值连接**为挑选关系R与关系S的广义笛卡尔积中**属性值相等的那些元组**。

​		自然连接是一种特殊的等值连接。它要求两个关系中**进行比较的分量**必须是**同名的属性组**

​		一般的等值连接是从行的角度来进行运算。而自然连接还要要求取消重复的列，从行与列的角度进行考虑



**七种连接模型：**

![](D:\STUDY\CS\学习笔记\数据库表连接示意图.png)



# 关系数据库标准语言SQL

​		sql是在1974年由Boyce和Chamberlin提出的，最初叫Sequel，并在IBM公司研制的关系型数据库管理系统原型System R 上实现。

​		目前，没有一个数据库系统能够支持SQL标准的所有概念和特性。同时，各软件厂商对sql基本命令集还进行了不同程度的扩充和修改，又可以支持标准以外的一系列功能。



| SQL功能  | 动词                 |
| -------- | -------------------- |
| 数据查询 | SELECT               |
| 数据定义 | CREATE,DROP,ALTER    |
| 数据操纵 | INSERT,UPDATE,DELETE |
| 数据控制 | GRANT,REVOKE         |



# 关系数据理论

​		为何要规范化设计数据库（引入范式）？

​				解决数据冗余、更新异常、插入异常以及删除异常的问题

## 函数依赖

定义：

​		设R(U)是属性集U上的关系模式，X,Y是U的自己。

​		若对于R(U)的任意一个可能的关系r，r中不可能存在两个元组在X上的属性值相等，而在Y上的属性值不等。(即，两个元组的X属性相同时，Y属性也应该相同)

​		则称X函数确定Y或Y函数依赖于X，记作X->Y

​		*比如在设计学生表时，一个学生的学号能决定学生的姓名，也可称姓名属性依赖于学号，对于现实来说，就是如果知道一个学生的学号，就一定能知道学生的姓名，这种情况就是姓名依赖于学号，这就是函数依赖，函数依赖又分为非平凡依赖，平凡依赖；从性质上还可以分为完全函数依赖、部分函数依赖和传递函数依赖。

​		使用范围：

​				**函数依赖不是指关系模式R的某个或某些关系满足的约束条件，指的是关系R的一切关系均要满足的条件**



​		平凡函数依赖

​		当关系中属性集合Y是属性集合X的子集时(Y⊆X)，存在函数依赖X→Y，即一组属性函数决定它的所有子集，这种函数依赖称为平凡函数依赖。

​		非平凡函数依赖

​		当关系中属性集合Y不是属性集合X的子集时，存在函数依赖X→Y，则称这种函数依赖为非平凡函数依赖。

​		完全函数依赖

​		如果存在函数依赖X->Y,并且对于任意一个X真子集X’，都为X‘-/>Y，则称Y对X完全函数依赖。称为X-F>Y

​		部分函数依赖

​		如果存在函数依赖X->Y,并且对于所有一个X真子集X’，存在X‘->Y，则称Y对X完全函数依赖。

​		称为X-p>Y

​		传递函数依赖

​		设X,Y,Z是关系R中互不相同的属性集合，存在X→Y(Y !→X),Y→Z，则称Z传递函数依赖于X。



## 码

​		设K为R<U,F>中的一个属性或属性组合，若K-F>U，则K为R的候选码

​		如果U部分部分函数依赖于K，则K称为**超码**

​		而候选码是最小的超码

​		若候选码多于一个则选其中一个为主码

​		包含在任何一个候选码中的属性称为主属性。不包含在任何候选码中的属性称为非主属性或非码属性。若整个属性组是码，则称为全码





## 第一范式1NF

​		关系要符合一个最基本的条件：每一个分量必须是不可分的数据项。

## 第二范式2NF

​		在满足第一范式的情况下，每一个非主属性完全函数依赖于任何一个候选码。

## 第三范式3NF

​		在满足第一范式的情况下，若关系不存在这样的码，属性组Y及非属性组Z使得X->Y,Y->Z成立，Y-/>X。（即关系中每一个非主属性均不传递依赖于码，也不部分依赖于码）

​		（如同：一个属性组：学号，姓名，学习课程编号，学习课程名称。此时学习课程名称传递依赖与码学号）

## 扩充第三范式BCNF

​		由Boyce和Codd提出。

​		在满足第一范式的情况下，

​			所有非主属性对每一个码都是完全函数依赖

​			**所有主属性对每一个不包含他的码也是完全函数依赖**

​			没有任何属性完全函数依赖于非码的任何一组属性

## 模式分解

​		什么叫做模式分解？

​		关系模式R<U,F>的一个分解是：

​		ρ = {R1<U1,F1>,R2<U1,F2>,···,Rn<Un,Fn>}

​		其中U = ∪Ui，并且没有Ui∈Uj。Fi是F在Ui上的投影



​		**分解后产生的模式应与原模式等价**

​		等价的定义：

​				无损连接性、保持函数依赖、同时保证前两点

​		例：存在关系模式R<{Sno,Sdept,Mname},{Sno->Sdept,Sdept->Mname}>

​		分解关系：

​		ρ = {R1<{Sno,Sdept},{Sno->Sdept}>,R2<{Sdept,Mname},{Sdept->Mname}>}

# 数据库设计

## 数据库设计流程：

### 1.*需求分析

​		数据库设计的基础

​		主要有三方面要求：

​				1.信息要求：用户需要获得的信息和性质

​				2.处理要求：用户需要完成的数据处理功能

​				3.安全性和完整性要求

​		主要方法：1.调查组织结构机构情况  2.调查各部门业务情况  3.协助用户明确新系统的各种要求  4.确定新系统边界

​		需求分析的主要成果：数据字典

​		数据字典通常包括：数据项、数据结构、数据流、数据存储和处理过程几部分。

​		1.数据项：不可再分的数据单位

​					对数据项的描述通常包括以下内容：

​					{数据项名、数据项含义说明、别名、数据类型、长度、取值范围、取值含义、与其他数据项的逻辑关系、数据项之间的联系}

​		2.数据结构：反应数据之间的组合关系

​					对数据项的描述通常包括以下内容：

​					{数据结构名、含义说明、组成：{数据项或数据结构}}

​		3.数据流：数据结构在系统内的传输的路径

​					对数据流的描述通常包括以下内容：

​					{数据流名、说明、数据流来源、数据流去向、组成：{数据结构}、平均流量、高峰期流量}

​		4.数据存储：数据存储时数据结构停留或保存的地方

​					对数据存储的描述通常包括以下内容：

​					{数据存储名、说明、编号、输入的数据流、输出的数据流，组成：{数据结构}，数据量、存取品读，存取方式}

​		5.处理过程：具体处理逻辑一般用判定表或判定树来描述

​					对处理过程的描述通常包括以下内容：

​					{处理过程名、说明、输入：{数据流}、输出：{数据流}、处理：{简介说明}}

### 2.概念结构设计

​		将需求分析得到的用户需求抽象为信息结构。以及用E-R模型来表示概念模型。

​		E-R图中包括：实体、属性、实体之间的联系

### 3.逻辑结构设计

​		逻辑结构设计将概念设计阶段**设计好的E-R模型**转换为选用**数据库管理系统产品所支持的数据模型**相符合的逻辑结构。

​		对于实体：

​		1.一个实体型转换为一个关系模式

​		对于联系：

​		2.一个1：1联系可已转化为一个独立的关系模式，也可以与任意一端对应的关系模式合并

​		3.一个1：n联系可以转换为一个独立的关系模式，也可以与n端对应的关系模式合并

​		4.一个m：n联系转化为一个关系模式

​		5.三个或三个以上实体间的一个多元关系可以转换为一个关系模式

​		6.具有相同码的关系模式可以合并

​		数据模型的优化：

​				为了提高数据库应用系统的性能，需要对数据模型进行修改

​				不是规范化程度越高的关系就越好。

​				对关系模式进行一些必要分解：

​				水平分解：一个大关系中，经常被使用的数据约占20%，可以把经常被使用的数据分离出来形成一个子关系

​				垂直分级：把关系模式R的属性分解为若干子集合。垂直分解需要保证无损连接性和保持函数依赖

### 4.物理结构设计

​		为给定的逻辑数据模型选取一个最合适应用要求的物理结构的过程

​		通常分为两步：

​				确定数据库物理结构：主要指确认存取方法和存取结构

​				对物理结构进行评价：重点是时间和空间效率

​		常用的存取方法分为两种：

​				1.索引方法:主要有两种：B+树索引存取方法、hash索引存取方法

​				2.聚簇方法：为了提高某个属性（或属性组）的查询速度，**把这个或这些属性上具有相同值的元组集中存放在连续的物理块中**，称为聚簇。该属性（或属性组）称为聚簇码。

​					设计聚簇：对经常一起进行连接操作的关系建立聚簇。

​										如果一个关系的一组属性经常出现在相等比较条件中时，该单个关系可以建立聚簇

​										如果一个关系的一个（或一组）属性上的值重复率很高，则可以建立聚簇。

​					**一个关系只能加入一个聚簇**

​					**尤其是在与聚簇码有关的ORDER BY、GROUP BY、UNION、DISTINCT等sql语句中，聚簇特别有利**

​			确定存储结构：

​					将表和索引放在不同的磁盘上，在查询时可以调高读写效率。

### 5.数据库实施

### 6.数据库运行和维护